<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zte.msg.pushcenter.pccore.mapper.HistoryMapper">

    <select id="listHistorySms" resultType="com.zte.msg.pushcenter.pccore.entity.SmsInfo" parameterType="com.zte.msg.pushcenter.pccore.dto.req.SmsHistoryReqDTO">
        select * from sms_info
        <if test="appId!=null or phoneNum!=null or startTime!=null or endTime!=null or result!=null or templateId!=null">
            <trim prefix="where " suffixOverrides="and">
                <if test="appId!=null">
                    app_id=#{appId} and
                </if>
                <if test="templateId!=null">
                    template_id=#{templateId} and
                </if>
                <if test="phoneNum!=null">
                    phone_num like "%"#{phoneNum}"%" and
                </if>
                <if test="startTime!=null">
                    transmit_time >= #{startTime} and
                </if>
                <if test="endTime!=null">
                    #{endTime} >= transmit_time and
                </if>
                <if test="result!=null">
                    result=#{result} and
                </if>
            </trim>
        </if>
        group by id
        <if test="appName!=null">
            having GROUP_CONCAT("|",app_name,"|",to_pinyin(app_name),"|",pinyin(Num_char_extract(app_name,3)),"|",Num_char_extract(app_name,2),"|") like "%"#{appName}"%"
        </if>
    </select>

    <select id="listHistoryMail" resultType="com.zte.msg.pushcenter.pccore.entity.MailInfo" parameterType="com.zte.msg.pushcenter.pccore.dto.req.MailHistoryReqDTO">
        select * from mail_info
        <if test="appId!=null or receiveAddress!=null or startTime!=null or endTime!=null or result!=null">
            <trim prefix="where " suffixOverrides="and">
                <if test="appId!=null">
                    app_id=#{appId} and
                </if>
                <if test="receiveAddress!=null">
                    receive_address like "%"#{receiveAddress}"%" and
                </if>
                <if test="startTime!=null">
                    transmit_time >= #{startTime} and
                </if>
                <if test="endTime!=null">
                    #{endTime} >= transmit_time and
                </if>
                <if test="result!=null">
                    result=#{result} and
                </if>
            </trim>
        </if>
        group by id
        <if test="appName!=null">
            having GROUP_CONCAT("|",app_name,"|",to_pinyin(app_name),"|",pinyin(Num_char_extract(app_name,3)),"|",Num_char_extract(app_name,2),"|") like "%"#{appName}"%"
        </if>
    </select>

    <select id="listHistoryWechat" resultType="com.zte.msg.pushcenter.pccore.entity.WeChatInfo" parameterType="com.zte.msg.pushcenter.pccore.dto.req.WechatHistoryReqDTO">
        select * from wechat_info
        <if test="appId!=null or wechatName!=null or startTime!=null or endTime!=null or result!=null">
            <trim prefix="where " suffixOverrides="and">
                <if test="appId!=null">
                    app_id=#{appId} and
                </if>
                <if test="startTime!=null">
                    transmit_time >= #{startTime} and
                </if>
                <if test="endTime!=null">
                    #{endTime} >= transmit_time and
                </if>
                <if test="result!=null">
                    result=#{result} and
                </if>
            </trim>
        </if>
        group by id
        <if test="appName!=null or wechatName!=null">
            <trim prefix="having " suffixOverrides="and">
                <if test="wechatName!=null">
                    GROUP_CONCAT("|",wechat_name,"|",to_pinyin(wechat_name),"|",pinyin(Num_char_extract(wechat_name,3)),"|",Num_char_extract(wechat_name,2),"|") like "%"#{wechatName}"%" and
                </if>
                <if test="appName!=null">
                    GROUP_CONCAT("|",app_name,"|",to_pinyin(app_name),"|",pinyin(Num_char_extract(app_name,3)),"|",Num_char_extract(app_name,2),"|") like "%"#{appName}"%" and
                </if>
            </trim>
        </if>
    </select>

    <select id="listHistoryApplication" resultType="com.zte.msg.pushcenter.pccore.entity.ApplicationInfo" parameterType="com.zte.msg.pushcenter.pccore.dto.req.ApplicationHistoryReqDTO">
        select * from application_info
        <if test="appId!=null or targetPlatform!=null or audience!=null or startTime!=null or endTime!=null or result!=null">
            <trim prefix="where " suffixOverrides="and">
                <if test="appId!=null">
                    app_id=#{appId} and
                </if>
                <if test="targetPlatform!=null">
                    target_platform=#{targetPlatform} and
                </if>
                <if test="audience!=null">
                    audience=#{audience} and
                </if>
                <if test="startTime!=null">
                    transmit_time >= #{startTime} and
                </if>
                <if test="endTime!=null">
                    #{endTime} >= transmit_time and
                </if>
                <if test="result!=null">
                    result=#{result} and
                </if>
            </trim>
        </if>
        group by id
        <if test="appName!=null">
            having GROUP_CONCAT("|",app_name,"|",to_pinyin(app_name),"|",pinyin(Num_char_extract(app_name,3)),"|",Num_char_extract(app_name,2),"|") like "%"#{appName}"%"
        </if>
    </select>
</mapper>